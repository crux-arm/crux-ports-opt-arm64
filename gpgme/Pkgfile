# Description: A C wrapper and Python bindings library for GnuPG
# URL: https://www.gnupg.org/related_software/gpgme/
# Maintainer: Tim Biermann, tbier at posteo dot de
# Arch Maintainer: CRUX-ARM System Team, devel at crux-arm dot nu
# Depends on: gnupg python3-wheel swig
# Optional: qt5 qt6-base

name=gpgme
version=1.24.3
release=2
source=(https://www.gnupg.org/ftp/gcrypt/$name/$name-$version.tar.bz2)

build() {
  cd $name-$version

  prt-get isinst qt5 && PKGMK_GPGME_LANG+=' qt'

    PKGMK_GPGME=(
    --prefix=/usr
    --disable-fd-passing
    --disable-gpgsm-test
    --enable-static
    )

  export PYTHON='/usr/bin/python3'
  ./configure \
    "${PKGMK_GPGME[@]}" \
    --enable-languages="cl cpp python $PKGMK_GPGME_LANG"

  make
  make DESTDIR=$PKG install

  if prt-get isinst qt6-base; then
    make clean
    ./configure \
      "${PKGMK_GPGME[@]}" \
      --enable-languages="cpp qt6"

    make
    make DESTDIR=$PKG install
  fi

  rm -rf $PKG/usr/share/{common-lisp,info}
}
